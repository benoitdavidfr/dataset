title: Les fichiers Yaml définissant un JdD extract doivent être conformes à ce schéma
$schema: 'http://json-schema.org/draft-07/schema#'
definitions:
  schemaOfAField:
    description: définition d'un champ d'un n-uplet
    oneOf:
      - description: le champ peut n'être défini que par son nom
        type: 'null'
      - description: le champ peut être défini plus en détails
        type: object
        additionalProperties: false
        required: [description, type]
        properties:
          description:
            description: la définition du champ
            type: string
          type:
            description: le type du champ
            type: string
          pattern:
            description: éventuel pattern pour une valeur de type string
            type: string
          required:
            description: sous-champs oblgatoires pour une valeur de type object
            type: array
            items:
              type: string
          properties:
            description: définition des sous-champs pour une valeur de type object
            type: object
    
  schemaOfAnItem:
    description: description des tuples de la collection
    type: object
    required: [type]
    additionalProperties: false
    properties:
      type:
        description: chaque tuple est un object
        const: object
      additionalProperties:
        const: false
      required:
        description: liste des champs obligatoires
        type: array
        items:
          type: string
      properties:
        description: liste des champs du tuple, non obligatoire
        type: object
        additionalProperties: false
        patternProperties:
          '^[a-z]+':
            $ref: '#/definitions/schemaOfAField'
    
  schemaOfAListOfItems:
    type: object
    required: [title, description, type]
    additionalProperties: false
    properties:
      title:
        description: nom de la collection
        type: string
      description:
        description: description de la collection
        type: string
      type:
        description: la collection est une liste d'items
        const: array
      items:
        $ref: '#/definitions/schemaOfAnItem'
  
  schemaOfADictOfItems:
    type: object
    required: [title, description, type]
    additionalProperties: false
    properties:
      title:
        description: nom de la collection
        type: string
      description:
        description: description de la collection
        type: string
      type:
        description: la collection est un dict d'items
        const: object
      additionalProperties:
        enum: [true, false]
      patternProperties:
        type: object
        patternProperties:
          '':
            $ref: '#/definitions/schemaOfAnItem'
    
  schemaOfACollection:
    oneOf:
      - $ref: '#/definitions/schemaOfAListOfItems'
      - $ref: '#/definitions/schemaOfADictOfItems'
type: object
required: [title, description, schemaOfExtract, collections]
additionalProperties: false
properties:
  title:
    description: titre donné au fichier Yaml
    type: string
  description:
    description: description associée au fichier Yaml
    type: string
  schemaOfExtract:
    description: début du schéma du JdD extrait auquel il faut rajouter les schémas de chaque collection
    type: object
    additionalProperties: false
    properties:
      title:
        description: titre du JdD extrait
        type: string
      description:
        description: description associée au fichier extrait
        type: string
      type:
        const: object
      required:
        type: array
        items:
          type: string
      additionalProperties:
        const: false
      properties:
        type: object
        properties:
          $schema:
  collections:
    description: définition de chaque collection du JdD extrait indexée sur son nom dans le JdD extrait
    type: object
    additionalProperties: false
    patternProperties:
      '^[a-zA-Z0-9:_]+':
        type: object
        required: [source, $schema]
        additionalProperties: false
        properties:
          source:
            description: la collection source sous la forme {datasetName}.{collectionName}
            type: string
          $schema:
            $ref: '#/definitions/schemaOfACollection'
  eof:
    type: null
